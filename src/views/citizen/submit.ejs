<% layout('layouts/main') -%>
<h1 class="text-3xl font-bold text-emerald-800 mb-6">Submit Request</h1>

<div class="card p-4">
  <form id="submit-form" action="/citizen/requests" method="POST">
    <div class="mb-3">
      <label for="service_id" class="form-label">Select Service</label>
      <select class="form-control" id="service_id" name="service_id" required>
        <option value="">-- Select a Service --</option>
        <% services.forEach(service => { %>
          <option value="<%= service.id %>"><%= service.name %> (Fee: <%= service.fee || 'Free' %>)</option>
        <% }) %>
      </select>
    </div>
    <button type="button" onclick="saveDraft()" class="btn btn-secondary me-2">Save Draft</button>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
</div>

<script>
  // Auto-save form
  autoSaveForm('submit-form', 'submit-draft');
  // Load saved draft
  loadFormData('submit-form', 'submit-draft');
  // Manual save draft
  function saveDraft() {
    const form = document.getElementById('submit-form');
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });
    localStorage.setItem('submit-draft', JSON.stringify(data));
    alert('Draft saved!');
  }
</script>